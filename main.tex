\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{enumitem}

\title{Running Sigma16 Cheatsheet}

\usepackage{natbib}
\usepackage{graphicx}

\begin{document}

\maketitle


WARNING: THIS GUIDE COMES WITH NO GUARANTEES. IT IS MEANT TO HELP YOU RUN SIGMA16 AT YOUR OWN MACHINE BUT PLEASE DO NOT, I REPEAT DO NOT FOLLOW IT BLINDLY AND EXPECT IT TO BE A RECIPE FOR SUCCESS. ALSO, THIS GUIDE IS RATHER SARCASTIC, PLEASE BEAR THAT IN MIND WHEN PROCEEDING. I DO NOT MEAN TO MAKE FUN OF YOU, BUT IT'S JUST MORE ENTERTAINING IF I DO SO!

\setcounter{section}{-1}
\section{Pre-requisites}
 For the rest of the guide I am assuming that you have already downloaded the Sigma16-2.4.7.zip from moodle and have extracted it somewhere on your machine. Previous versions are guaranteed to not work following this guide, and as for future ones, I'll try to update the doc as these roll-out.

\section{Introduction}

 If you've got here you are either very lost, own a mac or just want to get that thing going. Perhaps because you've only got a few hours to submit your AX (Oops). Fear not, we are here to help. Follow the instructions below on how to get Sigma16 setup on your own machine.

\section{Running it the easy (less proper) way. Running with Wine.}

\setcounter{subsection}{-1}
 \subsection{Windows}
   What are you doing here people... just double click the extracted Sigma16.exe thing and follow the instructions. Go to the other guides!!! Jeez, now that we've got them out of the way let's proceed.

 \subsection{Linux-generic}
 \begin{enumerate}
      
 
   \item Open that scary dark thing called 'the terminal' and type: 
\begin{lstlisting}[language=Bash]
sudo apt-get install wine-stable
\end{lstlisting}
    (because you do not want unstable thing laying around your PC. The person in front is already enough)
   \item Make sure you've installed Wine. Type
\begin{lstlisting}[language=Bash]
wine --version
\end{lstlisting}
and you should see a version number appear if previous step went well or a crazy error message if you've messed something up.
   \item Go to the directory where you extracted the sigma files using the terminal (the place where your sigma16.exe or sigma16.exe.exe is located)
   \item In that directory type
\begin{lstlisting}[language=Bash]
wine Sigma16.exe
\end{lstlisting}
    or 
\begin{lstlisting}[language=Bash]
wine Sigma16.exe.exe
\end{lstlisting}
depending on which executable file you've got
   \item That is it you're all done. Wasn't so bad was it?
\end{enumerate}
 \subsubsection{Mac (OSX)}
 \begin{enumerate}[start=0]
   \item Ok, since mac is very secure (weird) and everything needs to be approved it is a bad env for development, unless you get some package manager like homebrew. If you do not already have homebew run

\begin{lstlisting}[language=Bash,breaklines]
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
\end{lstlisting}

   in the terminal and follow the instructions.
   \item Then install wine, using brew. Run
\begin{lstlisting}[language=Bash]
brew install wine
\end{lstlisting}
   \item Navigate to the folder where you extracted your sigma files. The one with Sigma16.exe or Sigma16.exe.exe
   \item Run 
\begin{lstlisting}[language=Bash]
wine Sigma16.exe
\end{lstlisting}
    or 
\begin{lstlisting}[language=Bash]
wine Sigma16.exe.exe
\end{lstlisting}
depending on which executable you've got
   \item Enjoy the sigma experience!
\end{enumerate}

\subsection{End of the section}
 \textit{Disclaimer:}
 Congratulations! You are now officially running Sigma16. Please note that the product (both Wine and Sigma16 lol, but I've only participated in the development in one of them so do not blame me) is buggy and this guide takes no responsibility for any potential damage. Not that you are expected to receive some, but I'm just setting my insurance here.

\textbf{Q}: What are the pros and cons of running it with wine?

\textbf{A}: There are many reasons why you \textit{do not} want to use wine in general. A good rule of thumb is use wine as a last resort. For you, a reason to not use wine might be that all your peers that did not use it, might have something to mock you about.

 Pros:
\begin{itemize}
    \item It's relatively easy to set it up
    \item You do not necessarily need the knowledge that full computer geeks have ( wait for the 3rd moon in November when Pluto is casting shadow over one of it's moons then use an enhanced lithium crystal in order to deflect the right amount of light on your circuit so the build finally completes with no errors), when they prefer to compile everything from scratch.
    \item Even a Windows user will not be scared when they see the result of your execution (This can also be a Con)
\end{itemize}

 Cons:
 \begin{itemize}
     \item It's just a bad way to do it.
     \item Essentially what you are doing is "emulating" a Windows environment and thus might experience slower response rate
     \item Because of the emulation and how sigma saves things, it might be a bit trickier to find where your saved item is (unless you saved it somewhere you knew was good), In any case if your all important item (AX) is missing, go see the troubleshoot section.
 \end{itemize}


\section{Running it the proper comp. sci. person (proper) way. Install it from source.}
\textit{Disclaimer}:
 Here be DRAGONS!!!! Proceed at your own risk. This sounds very scary so be warned you are gonna have to use 'the terminal' again, use a real programming language and possibly edit some config files! Shocking, if you've got weak nerves and have not yelled at your screen before, you probably do not want to continue reading this section. Ok enough fireside talk let's get to business.


 \subsection{Linux}
 \begin{enumerate}
      

   \item Open the terminal. This should really be your habit by now... We'll only make use of this tool for the tutorial
   \item Check if you've already got Haskell on your machine. Run 
\begin{lstlisting}[language=Bash]
ghc --version
\end{lstlisting}
If you see a version number make sure it's 8.0.2 or newer. If you see a message saying you do not have Haskell on your machine... How dare you, after all the university came up with the thing, surely you should be a Haskell expert studying in university of Glasgow.
   \item Install haskell-platform if you do not already have one. If you do, proceed to step 3. Run
\begin{lstlisting}[language=Bash]
sudo apt-get install haskell-platform.
\end{lstlisting}
    \item Make sure your version of haskell is at least 8.0.2 (Run step 2 again) if it isn't bad times you are \textit{doomed}, close your PC and run away... Or just go to the Troubleshoot section and \textit{seriously} consider upgrading your linux-distribution -.- .
   \item In your terminal navigate to the folder where you extracted your sigma files e.g /home/USER/Sigma16-2.4.7
   \item Run
\begin{lstlisting}[language=Bash]
cabal update
\end{lstlisting}
    If you do not have cabal at this point go to the troubleshoot section.
   \item Run
\begin{lstlisting}[language=Bash]
cabal install --only-dependencies
\end{lstlisting}

   \item Run
\begin{lstlisting}[language=Bash]
cp app/Main.hs src/haskell/Main.hs
\end{lstlisting}
   \item Run 
\begin{lstlisting}[language=Bash]
ghci -isrc/haskell
\end{lstlisting} (at this point you should see the glourious haskell compiler's interpreter in action)
   \item The next steps assume you are insude the ghci prompt
   \item Run 
\begin{lstlisting}[language=Bash]
:load Main
\end{lstlisting}
If at that point you see src/haskell/SysEnv error, you've messed up. Go to the troubleshoot section...
   \item Run 
\begin{lstlisting}[language=Bash]
main
\end{lstlisting}
   \item That's it you've successfully interpreted Sigma16 on your own!!! Well... I'll just pretend I wasn't here. Now follow the onscreen instructions, open your browser and go to \url{http://127.0.0.1:8023}
   \item If the page is constantly refreshing after you've done so go to the troubleshoot section

 \end{enumerate}

\subsection{Mac (OSX)}
You are in luck, since Brew decided to not support Haskell-platform anymore, because apple provided your favorite drag-n-drop installers you do not have to use 'The terminal` for the whole tutorial (just most of it).
\begin{enumerate}
    \item Just follow the instructions under \url{https://www.haskell.org/platform/mac.html} to get your Haskell-environment going and follow the rest of the steps
    \item Now that you have Haskell on your machine (hopefully a correct version) go to the linux section and follow the instructions starting from step 4. Turns out Linux and Mac are not all that different, who would have thought? Maybe it has to do something with the Unix kernel.
\end{enumerate}


\section{Troubleshoot}

\textit{Note:} If you do not see your problem here it might be worth to report it, or you might have hit an older version of the document. To check whether the latter is correct you can go to: \url{https://github.com/janev94/Sigma16-Extra/}
and check whether a new version was submitted recently, or I've given up support for the document altogether :(



\textbf{Issue:} \textit{I do not know how to open that scary thing called 'The terminal'?} Before you judge me for putting this up here - it's a true story, I am not gonna call out names, but some of you have asked me that in the past.

\textbf{Resolution:}

\textbf{Linux:}
Now I am judging you... Usually, the terminal is bound to ctrl+shift+T, so try that if it is not, press your windows key and type 'terminal'. If that does not help as well, well use Google and find out how to open the terminal for your distribution of Linux.

\textbf{Mac (OSX):}
Press Control + Option + Shift + T, if that does not do it find the icon of the terminal in your apps (looks like a black square, you've never clicked it before). If neither of this methods work, resort to Google.


\textbf{Issue:} \textit{I do not know how to navigate to a folder in the terminal.}

Assuming you are in your home directory (the one that pops-up by default), use the \textbf{cd} command to navigate to a different folder. For advanced users, or adventure-seekers you can combine \textbf{cd} with a back-slash in order to change multiple directories (amazing stuff). For example, if you extracted your sigma in a directory called Sigma16-X in your Downloads folder you can go there, by running:

\begin{lstlisting}[language=Bash]
cd Downloads\Sigma16-X
\end{lstlisting}
from your home directory.

\textit{Tip for Mac users:}

You can navigate to the directory you want to open your terminal window in with Finder, then click on the finder menu, go to services and select `New Terminal at folder'.

\textbf{Resolution:}
 

 \textbf{Issue:}
 
\textit{ My haskell is \textbf{7.X.X}, HELP!}
 
\textit{ \textbf{I do not have Cabal}, what should I do?}

\textbf{Resolution:}
 
        \textit{Do the ghcup magic. Cast spells, make potions, lift curses and pray for the best.}
        
        \begin{enumerate}
             
        \item Go to your home directory
        \item Run
\begin{lstlisting}[language=Bash,breaklines]
( mkdir -p ~/.ghcup/bin && curl https://raw.githubusercontent.com/haskell/ghcup/master/ghcup > ~/.ghcup/bin/ghcup && chmod +x ~/.ghcup/bin/ghcup) && echo "Success"
\end{lstlisting}
        \item If you do not see "Success" printed at the end... You're in some deep trouble contact me or John
        \item Install haskell 8.0.2. Run 
\begin{lstlisting}[language=Bash]
ghcup install 8.0.2
\end{lstlisting}
        \item Set 8.0.2 as your default haskell compiler. Run
\begin{lstlisting}[language=Bash]
ghcup set 8.0.2
\end{lstlisting}
        
        \item Install cabal. Run
\begin{lstlisting}[language=Bash]
ghcup install-cabal
\end{lstlisting}

        \item update the cabal-install. Run
\begin{lstlisting}[language=Bash]
cabal new-install cabal-install
\end{lstlisting}

        \item Continue from step 3 in the linux section.
        \end{enumerate}

 \textbf{Issue:}
 
 \textit{Web page is constantly \textbf{refreshing} I cannot see my Sigma in the browser.}
 
 \textbf{Resolution:}
 
        Well, well, well. Look who's back here. Now there, there, we'll help you again. Most likely, you've encountered an issue where your sigma missinterpets your data directory that is ok, we'll fix it.
        \begin{enumerate}
             
        
        \item Go to the folder where your extracted sigma is.
        \item Run
\begin{lstlisting}[language=Bash]
EXPORT SIGMA16=`pwd`
\end{lstlisting}
        
        \textit{NOTE:} The characters around pwd are called backticks! Make sure you use those and not quotes!
	\item You might consider adding SIGMA16 to your .bashrc, unless you want to do step2 everytime there's this issue.
    \end{enumerate}

 \textbf{Issue:} 
 
 \textit{I've messed up :(. I see \textbf{src/haskell/SysEnv error} whenever I try to load Main.}
 
 \textbf{Resolution:}
 
        It's ok, probably your cabal is outdated. Just follow the instructions under \textit{"My Haskell is 7.X.X, HELP!"}

\textbf{Issue:}
 \textit{My Sigma does not do anything when I press "Assemble"}
 
\textbf{Resolution:}
 You might be experiencing one of the most rare `features' of Sigma. To verify that this is the case open the terminal(console) window and check whether you get some message for invalid ascii characters. If you do, then you are one of the few chosen ones that get to have the full Sigma 16 experience! But seriously, it is a weird bug we're trying to trace down (unsuccessfully so far as you can see), but fear not, we've got the work-around nailed down! So what you need to do is:
 \begin{enumerate}
     \item Copy all the code you currently have on your clipboard (or save it to a file)
     \item Press the 'Example' button
     \item Go the the Assembler and press Assemble
     \item Now that your sigma is all patched-up, simply delete the example and replace it with your code, which was not willing to assemble
 \end{enumerate}

\textbf{Issue:}
 \textit{Sigma complains that \textbf{cmpgt/cmplt/cmpeg/jumpf/jumpt} are invalid instructions}
 
\textbf{Resolution:}

Now, this is usually version dependent. For example, if you are running 2.3.X you will experience Sigma pretending not to know what these instructions are (How dare you Sigma, the students know you are fooling them around). So your two options now are either:
\begin{enumerate}
    \item Call your tutor and ask them to explain you how the \textbf{cmp/jumplt\\/jumpgt etc} instructions work (Oh no, learning more stuff!)
    \item Go to the Moodle page and download a version that \textit{does} understand these instructions, e.g. 2.4.X and use that to assemble your code.
\end{enumerate}

\section{Final Words}
 If you've found that useful, or have any critiques, comments or difficulties, feel free to contact me at m.yanev.1@research.gla.ac.uk. You know, just to say Thanks or Your guide was B*. Whatever you want, I am lonely and \textit{definitely} do not get a lot of email, but seriously contact me, I'll try and help you.
 
 \textit{Note:}
  I know LaTeX was probably a bad choice for the 'prettier' document. If you have found any troubles copy-pasting from this document, let me know and I might consider migrating it to something more clipboard-friendly.

\end{document}
